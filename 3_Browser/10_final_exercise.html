<html>
    <!--
            
        /////////////////////////////////
        Exercise Sheet 10: Final Exercise
        /////////////////////////////////

        In this exercise you **simulate** a remote connection to a server.

        After pressing "Submit" the following things should happen:
        
        1. Validate the text inside of the textarea: the text must be longer than 10 characters.

        2. If validation fails, color the texarea red and display a warning (an alert is fine). Upon typing again in the textarea, remove warnings and reset default colors. 

        3. If the text is validated, wait 5 seconds for a reply from the simulated server.
        Hint: setTimeout().
        
        4. While waiting all forms must be disabled.

        5. Simulated server returns an error or a success message in the form of a serialized JSON object.
        Hint: https://www.w3schools.com/jsref/jsref_obj_json.asp.

        6. Parse the object and discover what the server replied.

        7. The server returns an error, with the following probabilities:

        - 10% if you selected subject line "You are great"
        - 90% if you selected subject line "You suck!"
        - 50% if you selected subject line "You are kind of OK"

        8. Keep a log of the replies from the server by adding a new element with a timestamp and the outcome of the request in the diary div.

        9. The log entries should be appended as items of an unordered list.
        Hint: Tags <ul> and <li>.

    -->

    <title>Final Exercise</title>

    <link rel="stylesheet" href="./css/style_interactions.css" />
    <link rel="stylesheet" href="./css/style_inputs.css" />
    </head>

    <body>
        <div id="main">
            <div class="container">
                <div id="below" class="img-container">
                    <a href="https://en.wikipedia.org/wiki/Brendan_Eich" target="_blank">
                        <img data-name="Brendan" src="https://external-content.duckduckgo.com/iu/?u=https%3A%2F%2Fwww.welt.de%2Fimg%2Fwirtschaft%2Fwebwelt%2Fmobile126347555%2F0372502857-ci102l-w1024%2FMozilla.jpg&f=1&nofb=1" />
                    </a>
                </div>
            </div>
        </div>
        
        <div id="who" class="container">
            <strong>Write a letter to Brendan</strong>
            <br/> <br/>
                
                <label for="brendan-subject">
                   Select a predefined subject line.
                </label>
                <select id="brendan-subject">
                    <option>You are great!</option>
                    <option>You suck!</option>
                    <option>You are kind of OK</option>
                </select>
                <br/>
                <label for="brendan-text">Dear Brendan,</label>
                <textarea id="brendan-text" ></textarea>
                <br/>

                <label for="brendan-sign">Sign, if you wish.</label>
                <input id="brendan-sign" type="text" />
                <br/>
                
                <input type="submit" value="Submit" id="send" />

        </div>

        <div id="diary" class="container" style="display: none;">
           
        </div>


        <script>
              
            const formatMsg = (subject, text, signature) => {
                let out = [ 
                    'Yours', 'Truly', 'So long', 'With deference', 'Adios',
                    'Uf wiederluege'
                ];
                out = out[Math.floor(Math.random()*out.length)];

                let date = new Date().toUTCString();

                signature = signature || 'Anonymous';

                return `<span style="font-size: medium">${date}</span><br><br>
                           <strong>${subject}</strong><br><br>
                           Dear Brendan,<br><br>
                           ${text}<br><br>
                           ${out},<br>
                           ${signature}<br>
                           <hr>
                           <br>`; 
            };

            // Survey about feelings.
            document.getElementById('send').onclick = event => {
                // let q = document.querySelector; 

                let subject = document.querySelector('#brendan-subject').value;
                let text = document.querySelector('#brendan-text').value;
                let signature = document.querySelector('#brendan-sign').value;

                
                let diary = document.querySelector('#diary');
                diary.style.display = '';
                
                let div = document.createElement('div');
                
                div.innerHTML = formatMsg(subject, text, signature);
                diary.appendChild(div);
            }
        </script>


        <!-- 

            Exercise 1. Capture the inputs.
            //////////////////////////////

        -->

        <!-- 

            Exercise 2. Write the letter.
            //////////////////////////////

        -->

        

    </body>

</html>